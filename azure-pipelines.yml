pool: "Hosted Ubuntu 1604"

trigger:
  branches:
    include:
    - master
  paths:
    exclude:
    - README.md

pr: none

steps:
- task: Docker@1
  displayName: 'Build an image'
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryEndpoint: 'gitlab registry'
    arguments: |
     --build-arg buildnumber=$(Build.BuildNumber)
    imageName: 'registry.gitlab.com/ricardosantos9521/github/chattest.server:$(Build.BuildNumber)'

- task: Docker@1
  displayName: 'Push an image'
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryEndpoint: 'gitlab registry'
    command: 'Push an image'
    imageName: 'registry.gitlab.com/ricardosantos9521/github/chattest.server:$(Build.BuildNumber)'

- task: CopyFiles@1
  displayName: copy kubernetes yaml
  inputs: 
    contents: "deployment.yaml"
    targetFolder: $(Build.ArtifactStagingDirectory)

- task: CopyFiles@1
  displayName: copy redis yaml
  inputs: 
    contents: "redis.yaml"
    targetFolder: $(Build.ArtifactStagingDirectory)

- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: drop

      